<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LUXURY BY DARLIN ‚Äî Cat√°logo</title>
  <meta name="description" content="Cat√°logo de perfumes ‚Äî carrito y pedidos por WhatsApp." />
  <style>
    :root{
      --bg:#120a07;
      --panel:#1a0f0b;
      --card:#1f120d;
      --text:#f3efe9;
      --muted:#c9bfb5;
      --gold:#d8b36a;
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --r:18px;
      --r2:24px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      background:
        radial-gradient(1200px 600px at 20% -10%, rgba(216,179,106,.14), transparent 55%),
        radial-gradient(900px 500px at 110% 10%, rgba(216,179,106,.10), transparent 55%),
        var(--bg);
      color:var(--text);
    }

    .topbar{
      position:sticky; top:0; z-index:10;
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      padding:14px;
      background: rgba(18,10,7,.82);
      backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(216,179,106,.18);
    }
    .brand{display:flex; align-items:center; gap:12px; min-width: 220px;}
    .logo{
      width:44px; height:44px; border-radius: 14px;
      display:grid; place-items:center;
      border:1px solid rgba(216,179,106,.35);
      background: linear-gradient(180deg, rgba(216,179,106,.18), rgba(216,179,106,.06));
      color:var(--gold);
      font-weight:900;
      box-shadow: 0 10px 22px rgba(0,0,0,.28);
      user-select:none;
    }
    .brand-name{letter-spacing:.18em; font-weight:900; font-size:12px;}
    .brand-sub{color:var(--muted); font-size:12px; margin-top:2px}

    .top-actions{display:flex; align-items:center; gap:10px; width:100%; max-width: 760px; justify-content:flex-end;}
    .search-wrap{flex:1; max-width:520px}
    input, select, textarea{font-family:inherit}

    .search-wrap input{
      width:100%;
      padding:12px;
      border-radius: 14px;
      border:1px solid rgba(216,179,106,.20);
      background: rgba(26,15,11,.85);
      color:var(--text);
      outline:none;
    }
    .search-wrap input::placeholder{color:rgba(201,191,181,.7)}
    .search-wrap input:focus{border-color: rgba(216,179,106,.55); box-shadow: 0 0 0 4px rgba(216,179,106,.12);}

    .btn{
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid rgba(216,179,106,.22);
      background: rgba(26,15,11,.85);
      color:var(--text);
      cursor:pointer;
      font-weight:800;
      letter-spacing:.02em;
      white-space:nowrap;
    }
    .btn.primary{
      background: linear-gradient(180deg, rgba(216,179,106,.32), rgba(216,179,106,.16));
      border-color: rgba(216,179,106,.45);
      color:#fff7e6;
    }
    .btn:hover{border-color: rgba(216,179,106,.55)}

    .cart-btn{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid rgba(216,179,106,.22);
      background: rgba(26,15,11,.85);
      color:var(--text);
      cursor:pointer;
    }
    .cart-count{
      min-width: 22px; height: 22px; padding: 0 6px;
      border-radius: 999px;
      display:grid; place-items:center;
      background: rgba(216,179,106,.18);
      border:1px solid rgba(216,179,106,.35);
      color: var(--gold);
      font-weight:900;
      font-size:12px;
    }

    .layout{
      display:grid;
      grid-template-columns: 300px 1fr;
      gap:18px;
      padding: 16px;
      max-width: 1260px;
      margin: 0 auto;
    }

    .filters{
      position:sticky; top:78px; align-self:start;
      background: rgba(26,15,11,.75);
      border:1px solid rgba(216,179,106,.16);
      border-radius: var(--r2);
      padding:14px;
      box-shadow: var(--shadow);
    }
    .panel-title{
      font-weight:900;
      letter-spacing:.12em;
      font-size:12px;
      color: var(--gold);
      margin: 4px 0 12px;
    }
    .field{display:flex; flex-direction:column; gap:6px; margin-bottom:10px;}
    .field span{font-size:12px; color:var(--muted)}
    .field select, .field input, .field textarea{
      padding:11px 12px;
      border-radius: 14px;
      border:1px solid rgba(216,179,106,.20);
      background: rgba(18,10,7,.55);
      color:var(--text);
      outline:none;
    }
    .field textarea{min-height:140px; resize:vertical}
    .field select:focus, .field input:focus, .field textarea:focus{
      border-color: rgba(216,179,106,.55);
      box-shadow: 0 0 0 4px rgba(216,179,106,.12);
    }

    .note{
      margin-top: 10px;
      padding: 12px;
      border-radius: 16px;
      border: 1px dashed rgba(216,179,106,.22);
      color: var(--muted);
      background: rgba(18,10,7,.35);
    }
    .note-title{color:var(--text); font-weight:900; margin-bottom:6px}
    .hint{color:var(--muted); font-size:12px; margin-top:4px}

    .content-head{
      display:flex; align-items:flex-end; justify-content:space-between;
      padding: 4px 2px 12px;
      gap:10px;
    }
    .results{font-weight:900}

    /* ======= LISTADO POR MARCA (sin im√°genes) ======= */
    .brands{
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    .brand-section{
      background: rgba(26,15,11,.60);
      border:1px solid rgba(216,179,106,.16);
      border-radius: var(--r2);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .brand-header{
      padding:12px 14px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid rgba(216,179,106,.12);
      background: rgba(18,10,7,.35);
    }
    .brand-title{
      font-weight:900;
      letter-spacing:.06em;
      color:#fff7e6;
      font-size:14px;
      display:flex; align-items:center; gap:10px;
    }
    .brand-pill{
      font-size:11px;
      padding:6px 10px;
      border-radius: 999px;
      border:1px solid rgba(216,179,106,.22);
      color: var(--gold);
      background: rgba(216,179,106,.10);
      white-space:nowrap;
    }
    .brand-body{padding: 12px 12px 12px;}
    .list{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .item{
      background: rgba(31,18,13,.78);
      border:1px solid rgba(216,179,106,.14);
      border-radius: 18px;
      padding: 12px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    .item-left{min-width:0}
    .item-name{
      margin:0 0 6px;
      font-weight:900;
      font-size:15px;
      line-height:1.15;
    }
    .item-meta{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      color: var(--muted);
      font-size:12px;
    }
    .chip{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(216,179,106,.12);
      background: rgba(18,10,7,.35);
    }
    .item-note{
      margin-top:8px;
      color: var(--muted);
      font-size:12px;
    }
    .item-actions{
      display:flex;
      flex-direction:column;
      gap:8px;
      align-items:flex-end;
      flex-shrink:0;
    }
    .add-btn{
      padding: 10px 12px;
      border-radius: 14px;
      border:1px solid rgba(216,179,106,.30);
      background: rgba(216,179,106,.16);
      color: #fff7e6;
      cursor:pointer;
      font-weight:900;
      white-space:nowrap;
    }
    .add-btn:hover{border-color: rgba(216,179,106,.60)}
    .micro{
      font-size:11px;
      color:rgba(201,191,181,.85);
      text-align:right;
      max-width: 140px;
    }

    .footer{
      max-width:1260px;
      margin: 18px auto 28px;
      padding: 0 16px;
      display:flex; justify-content:space-between; align-items:center;
      color: var(--muted);
      font-size: 12px;
    }

    .backdrop{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      z-index: 30;
    }
    .hidden{display:none !important;}

    .drawer{
      position:fixed; top:0; right:0; bottom:0;
      width: min(440px, 92vw);
      background: rgba(26,15,11,.98);
      border-left:1px solid rgba(216,179,106,.18);
      z-index: 40;
      transform: translateX(105%);
      transition: transform .22s ease;
      display:flex; flex-direction:column;
    }
    .drawer.open{transform: translateX(0)}
    .drawer-head{
      padding: 14px;
      display:flex; justify-content:space-between; align-items:flex-start; gap:10px;
      border-bottom:1px solid rgba(216,179,106,.14);
    }
    .drawer-title{font-weight:900}
    .drawer-sub{color:var(--muted); font-size:12px; margin-top:3px}
    .icon-btn{
      border:1px solid rgba(216,179,106,.20);
      background: rgba(18,10,7,.45);
      color: var(--text);
      border-radius: 12px;
      width:38px; height:38px;
      cursor:pointer;
      font-weight:900;
    }
    .drawer-body{padding: 12px 14px; overflow:auto; flex:1;}
    .cart-item{
      padding: 10px 12px;
      border-radius: 16px;
      border:1px solid rgba(216,179,106,.14);
      background: rgba(18,10,7,.35);
      margin-bottom: 10px;
    }
    .ci-name{font-weight:900; font-size:13px; line-height:1.15}
    .ci-meta{color:var(--muted); font-size:12px; margin-top:4px}
    .qty-row{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top:10px}
    .qty-controls{display:flex; align-items:center; gap:8px}
    .qbtn{
      width:34px; height:34px;
      border-radius: 12px;
      border:1px solid rgba(216,179,106,.22);
      background: rgba(26,15,11,.65);
      color: var(--text);
      cursor:pointer;
      font-weight:900;
    }
    .qval{min-width: 22px; text-align:center; font-weight:900}
    .rm{
      border:1px solid rgba(255,107,107,.25);
      background: rgba(255,107,107,.10);
      color: #ff6b6b;
      padding: 0 10px;
      width:auto;
      white-space:nowrap;
    }
    .drawer-foot{
      padding: 14px;
      border-top:1px solid rgba(216,179,106,.14);
      background: rgba(18,10,7,.55);
    }

    .modal{
      position:fixed; inset:0;
      z-index:60;
      display:grid;
      place-items:center;
      background: rgba(0,0,0,.55);
      padding:16px;
    }
    .modal-card{
      width:min(900px, 96vw);
      background: rgba(26,15,11,.98);
      border:1px solid rgba(216,179,106,.18);
      border-radius: var(--r2);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .modal-head{
      padding:14px;
      display:flex; justify-content:space-between; align-items:flex-start; gap:10px;
      border-bottom:1px solid rgba(216,179,106,.14);
    }
    .modal-title{font-weight:900}
    .modal-sub{color:var(--muted); font-size:12px; margin-top:4px}
    .modal-body{padding:14px}
    .row{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    .row .btn{flex:1}

    @media (max-width: 980px){
      .layout{grid-template-columns: 1fr; }
      .filters{position:relative; top:auto}
      .top-actions{max-width: 100%;}
      .micro{display:none}
    }
    @media (max-width: 560px){
      .brand{min-width:auto}
      .brand-sub{display:none}
    }
  </style>
</head>

<body>
<header class="topbar">
  <div class="brand">
    <div class="logo" aria-hidden="true">L</div>
    <div class="brand-text">
      <div class="brand-name">LUXURY BY DARLIN</div>
      <div class="brand-sub">Cat√°logo ‚Ä¢ Carrito ‚Ä¢ Pedido por WhatsApp</div>
    </div>
  </div>

  <div class="top-actions">
    <div class="search-wrap">
      <input id="searchInput" type="search" placeholder="Buscar por perfume o marca‚Ä¶" autocomplete="off" />
    </div>
    <button id="importBtn" class="btn" type="button">IMPORTAR CAT√ÅLOGO</button>
    <button id="cartBtn" class="cart-btn" type="button" aria-label="Abrir carrito">
      <span aria-hidden="true">üõí</span>
      <span class="cart-count" id="cartCount">0</span>
    </button>
  </div>
</header>

<main class="layout">
  <aside class="filters">
    <div class="panel-title">Filtros</div>

    <label class="field">
      <span>Marca</span>
      <select id="brandSelect"></select>
    </label>

    <label class="field">
      <span>G√©nero</span>
      <select id="genderSelect"></select>
    </label>

    <label class="field">
      <span>Tama√±o (ml)</span>
      <select id="sizeSelect"></select>
    </label>

    <button id="clearFilters" class="btn" type="button">Limpiar filtros</button>

    <div class="note">
      <div class="note-title">Pedidos</div>
      <p style="margin:0">Los precios se consultan v√≠a WhatsApp. Agrega tus perfumes al carrito y env√≠a el pedido.</p>
    </div>

    <div class="note">
      <div class="note-title">Importar cat√°logo</div>
      <p style="margin:0">Formato:</p>
      <p style="margin:8px 0 0;color:var(--muted);font-size:12px">
        <b>Marca | Nombre | Tama√±o | G√©nero | Nota</b>
      </p>
    </div>
  </aside>

  <section class="content">
    <div class="content-head">
      <div class="result-meta">
        <div class="results" id="resultsCount">0 productos</div>
        <div class="hint">Cat√°logo ordenado por marca. Usa b√∫squeda o filtros.</div>
      </div>
    </div>

    <div id="brands" class="brands"></div>
  </section>
</main>

<div id="drawerBackdrop" class="backdrop hidden"></div>

<aside id="cartDrawer" class="drawer" aria-label="Carrito">
  <div class="drawer-head">
    <div>
      <div class="drawer-title">Tu carrito</div>
      <div class="drawer-sub">Se enviar√° por WhatsApp a +1 (829) 475-5065</div>
    </div>
    <button id="closeCart" class="icon-btn" type="button" aria-label="Cerrar">‚úï</button>
  </div>

  <div id="cartItems" class="drawer-body"></div>

  <div class="drawer-foot">
    <label class="field">
      <span>Nombre (opcional)</span>
      <input id="customerName" type="text" placeholder="Ej. Darlin" />
    </label>
    <label class="field">
      <span>Zona/Direcci√≥n (opcional)</span>
      <input id="customerZone" type="text" placeholder="Ej. Cabarete" />
    </label>
    <label class="field">
      <span>Nota (opcional)</span>
      <input id="customerNote" type="text" placeholder="Ej. Si hay alguna recomendaci√≥n similar, env√≠amela" />
    </label>

    <button id="sendWhatsApp" class="btn primary" type="button">Enviar pedido por WhatsApp</button>
    <button id="clearCart" class="btn" type="button">Vaciar carrito</button>
  </div>
</aside>

<footer class="footer">
  <div>¬© <span id="year"></span> LUXURY BY DARLIN</div>
  <div>Cat√°logo m√≥vil ‚Ä¢ Carrito real ‚Ä¢ WhatsApp</div>
</footer>

<div id="importModal" class="modal hidden" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true" aria-label="Importar cat√°logo">
    <div class="modal-head">
      <div>
        <div class="modal-title">Importar cat√°logo</div>
        <div class="modal-sub">
          Pega tu lista. Acepta pipes normales y de tablet (|ÔΩú¬¶‚îÇ). La X cierra SIEMPRE.
        </div>
      </div>
      <button id="closeImport" class="icon-btn" type="button" aria-label="Cerrar">‚úï</button>
    </div>
    <div class="modal-body">
      <label class="field">
        <span>Pega aqu√≠ (1 l√≠nea = 1 producto)</span>
        <textarea id="importText" placeholder="Ej:
Afnan | 9 AM Dive EDP | 100ml | Unisex | Consultar v√≠a WhatsApp"></textarea>
      </label>
      <div class="row">
        <button id="doImport" class="btn primary" type="button">Importar</button>
        <button id="clearCatalog" class="btn" type="button">Borrar cat√°logo</button>
        <button id="exportCatalog" class="btn" type="button">Exportar (copiar)</button>
      </div>
    </div>
  </div>
</div>

<script>
/* ===================== CONFIG ===================== */
const WHATSAPP_NUMBER = "18294755065";
const DEFAULT_NOTE = "Consultar v√≠a WhatsApp";
const LS_CATALOG = "LBD_CATALOG_TEXT_V1";
const LS_CART = "LBD_CART_TEXT_V1";

/* ===================== UTILS ===================== */
const el = (id)=>document.getElementById(id);
const norm = (s)=> (s ?? "").toString().trim();
const uniq = (arr)=> Array.from(new Set(arr)).filter(v=>v!=null && v!=="").sort((a,b)=>a.localeCompare(b,"es"));
function slug(s){
  return norm(s).toLowerCase()
    .replace(/[^\p{L}\p{N}]+/gu,"-")
    .replace(/^-+|-+$/g,"");
}
function parseMl(value){
  const s = norm(value);
  if(!s) return null;
  const m = s.match(/(\d{1,4})\s*ml/i);
  if(m) return Number(m[1]);
  const n = s.match(/(\d{1,4})/);
  return n ? Number(n[1]) : null;
}
function splitPipes(line){
  return line.split(/[|ÔΩú¬¶‚îÇ]/).map(p=>p.trim());
}
function safeText(s){ return (s ?? "").toString(); }

/* ===================== STORAGE ===================== */
function loadCatalog(){
  try{
    const raw = localStorage.getItem(LS_CATALOG);
    if(!raw) return [];
    const parsed = JSON.parse(raw);
    return Array.isArray(parsed) ? parsed : [];
  }catch{
    return [];
  }
}
function saveCatalog(){
  localStorage.setItem(LS_CATALOG, JSON.stringify(ALL));
}
function loadCart(){
  try{
    const raw = localStorage.getItem(LS_CART);
    if(!raw) return {};
    const parsed = JSON.parse(raw);
    return parsed && typeof parsed==="object" ? parsed : {};
  }catch{
    return {};
  }
}
function saveCart(){
  localStorage.setItem(LS_CART, JSON.stringify(cart));
}

/* ===================== DATA / STATE ===================== */
let ALL = loadCatalog();
let filtered = [];
let cart = loadCart();

/* ===================== SORT / GROUP ===================== */
function sortCatalog(list){
  return list.slice().sort((a,b)=>{
    const br = (a.brand||"").localeCompare(b.brand||"", "es");
    if(br!==0) return br;
    return (a.name||"").localeCompare(b.name||"", "es");
  });
}
function groupByBrand(list){
  const map = new Map();
  for(const p of list){
    const b = p.brand || "Sin marca";
    if(!map.has(b)) map.set(b, []);
    map.get(b).push(p);
  }
  return map;
}

/* ===================== FILTERS ===================== */
function setOptions(select, values){
  select.innerHTML="";
  for(const v of values){
    const opt=document.createElement("option");
    opt.value=v;
    opt.textContent=v;
    select.appendChild(opt);
  }
}
function buildFilters(){
  const brands = ["Todas"].concat(uniq(ALL.map(p=>p.brand)));
  const genders = ["Todos"].concat(uniq(ALL.map(p=>p.gender)));
  const sizes = ["Todos"].concat(uniq(ALL.map(p=>p.size_ml).filter(x=>x!=null).map(x=>String(x))));

  setOptions(el("brandSelect"), brands);
  setOptions(el("genderSelect"), genders);
  setOptions(el("sizeSelect"), sizes);

  el("brandSelect").value="Todas";
  el("genderSelect").value="Todos";
  el("sizeSelect").value="Todos";
}

function applyFilters(){
  const q = norm(el("searchInput").value).toLowerCase();
  const brand = el("brandSelect").value;
  const gender = el("genderSelect").value;
  const size = el("sizeSelect").value;

  filtered = ALL.filter(p=>{
    const matchQ = !q || (`${p.brand} ${p.name}`).toLowerCase().includes(q);
    const matchBrand = (brand==="Todas") || (p.brand===brand);
    const matchGender = (gender==="Todos") || (p.gender===gender);
    const matchSize = (size==="Todos") || (String(p.size_ml)===size);
    return matchQ && matchBrand && matchGender && matchSize;
  });

  renderBrands();
}

/* ===================== RENDER (POR MARCAS) ===================== */
function renderBrands(){
  const wrap = el("brands");
  wrap.innerHTML="";

  el("resultsCount").textContent = `${filtered.length} productos`;

  const sorted = sortCatalog(filtered);
  const groups = groupByBrand(sorted);

  for(const [brand, items] of groups.entries()){
    const section = document.createElement("div");
    section.className = "brand-section";

    const head = document.createElement("div");
    head.className = "brand-header";

    const title = document.createElement("div");
    title.className = "brand-title";
    title.textContent = brand;

    const pill = document.createElement("div");
    pill.className = "brand-pill";
    pill.textContent = `${items.length} items`;

    head.appendChild(title);
    head.appendChild(pill);

    const body = document.createElement("div");
    body.className = "brand-body";

    const list = document.createElement("div");
    list.className = "list";

    for(const p of items){
      const item = document.createElement("div");
      item.className = "item";

      const left = document.createElement("div");
      left.className = "item-left";

      const name = document.createElement("div");
      name.className = "item-name";
      name.textContent = p.name;

      const meta = document.createElement("div");
      meta.className = "item-meta";

      const c1 = document.createElement("div");
      c1.className = "chip";
      c1.textContent = p.gender || "Unisex";

      const c2 = document.createElement("div");
      c2.className = "chip";
      c2.textContent = (p.size_ml!=null ? `${p.size_ml} ml` : "Tama√±o N/D");

      meta.appendChild(c1);
      meta.appendChild(c2);

      const note = document.createElement("div");
      note.className = "item-note";
      note.textContent = p.note || DEFAULT_NOTE;

      left.appendChild(name);
      left.appendChild(meta);
      left.appendChild(note);

      const actions = document.createElement("div");
      actions.className = "item-actions";

      const add = document.createElement("button");
      add.className = "add-btn";
      add.type = "button";
      add.textContent = "A√±adir";
      add.addEventListener("click", ()=> addToCart(p.id));

      const micro = document.createElement("div");
      micro.className = "micro";
      micro.textContent = "Precio: por WhatsApp";

      actions.appendChild(add);
      actions.appendChild(micro);

      item.appendChild(left);
      item.appendChild(actions);

      list.appendChild(item);
    }

    body.appendChild(list);

    section.appendChild(head);
    section.appendChild(body);

    wrap.appendChild(section);
  }
}

/* ===================== CART ===================== */
function updateCartCount(){
  const count = Object.values(cart).reduce((a,b)=>a+(b||0),0);
  el("cartCount").textContent = String(count);
}
function addToCart(id){
  cart[id] = (cart[id]||0) + 1;
  saveCart();
  updateCartCount();
}
function decFromCart(id){
  if(!cart[id]) return;
  cart[id]--;
  if(cart[id]<=0) delete cart[id];
  saveCart();
  updateCartCount();
  renderCart();
}
function incToCart(id){
  cart[id] = (cart[id]||0) + 1;
  saveCart();
  updateCartCount();
  renderCart();
}
function removeFromCart(id){
  delete cart[id];
  saveCart();
  updateCartCount();
  renderCart();
}
function renderCart(){
  const wrap = el("cartItems");
  wrap.innerHTML="";

  const byId = new Map(ALL.map(p=>[p.id,p]));
  const ids = Object.keys(cart);

  if(ids.length===0){
    wrap.innerHTML = `<div class="note"><div class="note-title">Carrito vac√≠o</div><div style="font-size:12px;color:var(--muted)">Agrega perfumes para armar tu pedido.</div></div>`;
    return;
  }

  for(const id of ids){
    const qty = cart[id];
    const p = byId.get(id);
    if(!p) continue;

    const item=document.createElement("div");
    item.className="cart-item";

    const title=document.createElement("div");
    title.className="ci-name";
    title.textContent = `${p.brand} ‚Äî ${p.name}`;

    const meta=document.createElement("div");
    meta.className="ci-meta";
    meta.textContent = `${p.gender||"Unisex"} ‚Ä¢ ${p.size_ml!=null? p.size_ml+"ml":"N/D"} ‚Ä¢ ${p.note || DEFAULT_NOTE}`;

    const qtyRow=document.createElement("div");
    qtyRow.className="qty-row";

    const controls=document.createElement("div");
    controls.className="qty-controls";

    const minus=document.createElement("button");
    minus.className="qbtn";
    minus.type="button";
    minus.textContent="‚àí";
    minus.addEventListener("click", ()=> decFromCart(id));

    const val=document.createElement("div");
    val.className="qval";
    val.textContent=String(qty);

    const plus=document.createElement("button");
    plus.className="qbtn";
    plus.type="button";
    plus.textContent="+";
    plus.addEventListener("click", ()=> incToCart(id));

    controls.appendChild(minus);
    controls.appendChild(val);
    controls.appendChild(plus);

    const rm=document.createElement("button");
    rm.className="qbtn rm";
    rm.type="button";
    rm.textContent="Quitar";
    rm.addEventListener("click", ()=> removeFromCart(id));

    qtyRow.appendChild(controls);
    qtyRow.appendChild(rm);

    item.appendChild(title);
    item.appendChild(meta);
    item.appendChild(qtyRow);

    wrap.appendChild(item);
  }
}

/* ===================== OPEN/CLOSE ===================== */
function openCart(){
  el("drawerBackdrop").classList.remove("hidden");
  el("cartDrawer").classList.add("open");
  renderCart();
}
function closeCart(){
  el("drawerBackdrop").classList.add("hidden");
  el("cartDrawer").classList.remove("open");
}
function openImport(){
  el("importModal").classList.remove("hidden");
  el("importModal").setAttribute("aria-hidden","false");
}
function closeImport(){
  el("importModal").classList.add("hidden");
  el("importModal").setAttribute("aria-hidden","true");
}

/* ===================== IMPORT PARSER ===================== */
function parseImport(text){
  const lines = text.split("\n").map(l=>l.trim()).filter(Boolean);
  const out = [];
  const seen = new Set();

  for(const line of lines){
    if(!/[|ÔΩú¬¶‚îÇ]/.test(line)) continue;
    const parts = splitPipes(line);

    // Formato requerido: Marca | Nombre | Tama√±o | G√©nero | Nota
    if(parts.length >= 5){
      const brand = parts[0];
      const name = parts[1];
      const sizeText = parts[2];
      const gender = parts[3];
      // Nota puede tener pipes extra; la rearmamos desde el 4 en adelante
      const note = parts.slice(4).join(" | ").trim();

      const size_ml = parseMl(sizeText);
      const id = `${slug(brand)}-${slug(name)}-${size_ml||"x"}`;

      if(seen.has(id)) continue;
      seen.add(id);

      out.push({
        id,
        brand: brand || "Sin marca",
        name: name || "Sin nombre",
        gender: (gender && gender.trim()!=="") ? gender : "Unisex",
        size_ml: Number.isFinite(size_ml) ? size_ml : null,
        note: (note && note.trim()!=="") ? note : DEFAULT_NOTE
      });
    }
  }

  return out;
}

function doImportFromTextarea(){
  const text = el("importText").value;
  if(!norm(text)) return;

  const list = parseImport(text);

  if(list.length === 0){
    alert("No se import√≥ nada. Revisa el formato: Marca | Nombre | Tama√±o | G√©nero | Nota");
    return;
  }

  ALL = sortCatalog(list);
  saveCatalog();
  buildFilters();
  applyFilters();

  // limpia carrito de ids que ya no existan
  const ids = new Set(ALL.map(p=>p.id));
  for(const k of Object.keys(cart)){
    if(!ids.has(k)) delete cart[k];
  }
  saveCart();
  updateCartCount();
  renderCart();

  alert(`Importaci√≥n lista: ${ALL.length} productos.`);
  closeImport();
}

function clearCatalogConfirm(){
  const ok = confirm("¬øSeguro que quieres borrar el cat√°logo? (Esto borra lo guardado en este dispositivo)");
  if(!ok) return;
  ALL = [];
  saveCatalog();
  buildFilters();
  applyFilters();
}

function exportCatalogToClipboard(){
  const lines = ALL.map(p=>{
    const size = p.size_ml!=null ? `${p.size_ml}ml` : "";
    const gender = p.gender || "Unisex";
    const note = p.note || DEFAULT_NOTE;
    return `${p.brand} | ${p.name} | ${size} | ${gender} | ${note}`;
  }).join("\n");

  if(navigator.clipboard && navigator.clipboard.writeText){
    navigator.clipboard.writeText(lines).then(()=>{
      alert("Cat√°logo copiado. P√©galo donde quieras.");
    }).catch(()=>{
      el("importText").value = lines;
      alert("No pude copiar autom√°ticamente. Te lo dej√© en el cuadro para que lo copies manual.");
    });
  }else{
    el("importText").value = lines;
    alert("Tu navegador no permite copiar autom√°tico. Te lo dej√© en el cuadro para que lo copies manual.");
  }
}

/* ===================== WHATSAPP ===================== */
function buildWhatsAppMessage(){
  const byId = new Map(ALL.map(p=>[p.id,p]));
  const items = Object.keys(cart).map(id=>{
    const qty = cart[id];
    const p = byId.get(id);
    if(!p) return null;
    const mlTxt = (p.size_ml!=null ? `${p.size_ml}ml` : "Tama√±o N/D");
    const genTxt = (p.gender || "Unisex");
    return `‚Ä¢ ${qty} x ${p.brand} ‚Äî ${p.name} (${mlTxt}, ${genTxt})`;
  }).filter(Boolean);

  const name = norm(el("customerName").value);
  const zone = norm(el("customerZone").value);
  const note = norm(el("customerNote").value);

  const lines = [];
  lines.push("üëã Hola, buenas.");
  lines.push("‚ú® Me gustar√≠a cotizar y hacer un pedido del siguiente listado:");
  lines.push("");
  lines.push(...items);
  lines.push("");
  if(name) lines.push(`üë§ Nombre: ${name}`);
  if(zone) lines.push(`üìç Zona/Direcci√≥n: ${zone}`);
  if(note) lines.push(`üìù Nota: ${note}`);
  lines.push("");
  lines.push("‚úÖ Quedo atento/a a disponibilidad y precio. ¬°Muchas gracias! üôè");

  return lines.join("\n");
}
function sendWhatsApp(){
  if(Object.keys(cart).length===0){
    alert("Tu carrito est√° vac√≠o.");
    return;
  }
  const msg = buildWhatsAppMessage();
  const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`;
  window.open(url, "_blank");
}

/* ===================== EVENTS ===================== */
function wire(){
  el("year").textContent = String(new Date().getFullYear());

  el("searchInput").addEventListener("input", applyFilters);
  el("brandSelect").addEventListener("change", applyFilters);
  el("genderSelect").addEventListener("change", applyFilters);
  el("sizeSelect").addEventListener("change", applyFilters);

  el("clearFilters").addEventListener("click", ()=>{
    el("searchInput").value="";
    buildFilters();
    applyFilters();
  });

  el("cartBtn").addEventListener("click", (e)=>{
    e.preventDefault(); e.stopPropagation();
    openCart();
  });
  el("closeCart").addEventListener("click", (e)=>{
    e.preventDefault(); e.stopPropagation();
    closeCart();
  });
  el("drawerBackdrop").addEventListener("click", closeCart);

  el("sendWhatsApp").addEventListener("click", (e)=>{
    e.preventDefault(); e.stopPropagation();
    sendWhatsApp();
  });
  el("clearCart").addEventListener("click", (e)=>{
    e.preventDefault(); e.stopPropagation();
    const ok = confirm("¬øVaciar carrito?");
    if(!ok) return;
    cart = {};
    saveCart();
    updateCartCount();
    renderCart();
  });

  el("importBtn").addEventListener("click", (e)=>{
    e.preventDefault(); e.stopPropagation();
    openImport();
  });

  el("closeImport").addEventListener("click", (e)=>{
    e.preventDefault();
    e.stopPropagation();
    closeImport();
  });

  el("doImport").addEventListener("click", (e)=>{
    e.preventDefault();
    e.stopPropagation();
    doImportFromTextarea();
  });

  el("clearCatalog").addEventListener("click", (e)=>{
    e.preventDefault(); e.stopPropagation();
    clearCatalogConfirm();
  });

  el("exportCatalog").addEventListener("click", (e)=>{
    e.preventDefault(); e.stopPropagation();
    exportCatalogToClipboard();
  });

  el("importModal").addEventListener("click", (e)=>{
    if(e.target === el("importModal")) closeImport();
  });

  document.addEventListener("keydown", (e)=>{
    if(e.key === "Escape" && !el("importModal").classList.contains("hidden")){
      closeImport();
    }
  });
}
/* ===================== INIT ===================== */
function init(){
  wire();
  ALL = sortCatalog(ALL);
  buildFilters();
  filtered = ALL.slice();
  applyFilters();
  updateCartCount();
}
init();
</script>
</body>
</html>
```Ó®Å0Ó®Ç
